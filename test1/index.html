<html>
	<head>
		<script>

			var gChannelCommandControl      = "af230002-879d-6186-1f49-deca0e85d9c1";
			var gChannelSensorPacket1       = "af230003-879d-6186-1f49-deca0e85d9c1";
			var gChannelSensorPacket2       = "af230006-879d-6186-1f49-deca0e85d9c1";

			var gEndPointDefault            = "af237777-879d-6186-1f49-deca0e85d9c1";

			var gCharacteristicCommand;

			function gebid(id) {
				return document.getElementById(id);
			}

			function doit() {

			  navigator.bluetooth.requestDevice({filters: [{services:[gEndPointDefault]}]})
				.then(device => {
					console.log('Connecting to GATT Server...');
					return device.gatt.connect();
				})
				.then(server => {
					console.log('Getting Service...');
					return server.getPrimaryService(gEndPointDefault);
				})
				.then(service => {
					return service.getCharacteristic(gChannelCommandControl);
				})
				.then(characteristic => {
					var cmd = Uint8Array.of(0x03,0xf0,0xf0,0x00);
					gCharacteristicCommand = characteristic;

					gebid('buttons').style.display="block";
					updateInfo(characteristic);

					return characteristic.writeValue(cmd);
				})

			}

			function rgb(r, g, b) {
				var cmd;
				cmd = Uint8Array.of(0x03, r, g, b);
				gCharacteristicCommand.writeValue(cmd);
			}

			function updateInfo(characteristic) {
				var s = "";
				s += "Connected to <b>" + characteristic.service.device.name + "</b>.";

				gebid('info').innerHTML = s;

			}
		</script>
	</head>
	<body>
		hello.<br>
		<button onclick="doit()">click me</button><br>
		<div id="info" style="font-family:courier"></div>
		<div id="buttons" style="display:none">
			<button onclick="rgb(255, 255,   0)">yellow</button>
			<button onclick="rgb(255,   0, 255)">magenta</button>
			<button onclick="rgb(  0, 255, 255)">cyan</button>
		</div>
	</body>
</html>

